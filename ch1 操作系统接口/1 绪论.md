## 1. 操作系统的任务

- 在多个程序之间共享一台计算机，并提供比硬件本身支持的更有用的服务（透过指令集编写程序）
- 管理和抽象底层硬件
- 在多个程序之间共享硬件，这样它们就可以(或者看起来可以)同时运行（并发）
- 操作系统为程序提供了可控的交互方式，这样它们就可以共享数据或者一起工作（进程间的沟通）

操作系统通过接口向用户程序提供服务，用户访问操作系统提供的接口实现更高级的功能，接口本身是对底层的一层抽象。一方面，我们希望接口简单明了，因为这样更利于正确使用。另一方面，我们可能倾向于为应用程序提供许多复杂的特性。因此，保持单个接口的简洁与多个接口的可结合机制。
## 2. xv6的内核机制

![xv6 kernel.png](./assets/xv6%20kernel.png)

如图，xv6采用传统的内核形式（内核是一个特殊的程序，为正在运行的程序提供服务）。每个正在运行的程序，称为进程，都有包含指令、数据和堆栈的内存。

- 指令：实现程序的运算
- 数据：计算所依赖的变量
- 堆栈：组织程序的过程调用

一台给定的计算机通常有许多进程，但只有一个内核。

当一个进程需要调用一个内核服务时，它会调用一个**系统调用**，这是操作系统接口中的一个调用。系统调用进入内核；内核执行服务并返回。因此，一个进程在用户空间和内核空间之间交替执行（就像图中所演示的那样）。

内核通过**硬件保护机制**确保进程只能访问其自己的内存，内核程序拥有操控硬件的权限，因此它可以进行这种保护。用户程序执行调用函数时，硬件提升级别并执行预先安排好的函数。

内核提供的**系统调用集合**是用户程序看到的**接口**。通过这些接口，可以编写用户程序。

Shell是一个普通的程序，它从用户那里读取命令并执行它们。Shell是一个用户程序，而不是内核的一部分。*它的实现可以在(user/sh.c:1)中找到*。